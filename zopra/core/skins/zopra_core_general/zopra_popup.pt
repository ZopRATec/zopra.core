<!DOCTYPE html>
<html i18n:domain="zopra">
<tal:comment replace="nothing">
    Opens an arbitrary page as popup, makes its representation simpler and add some behaviour by css- and js-injection.
</tal:comment>
<head tal:define="portal_url here/portal_url">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

    <script type="text/javascript" tal:attributes="src string:${portal_url}/++resource++plone.app.jquery.js"></script>
    <link rel="stylesheet" type="text/css" tal:attributes="href string:${portal_url}/autoupdate-widget/jquery.autoupdate-widget.css" media="screen" />
    <title i18n:translate="zopra_popup_title">Popup: TUD - Editorial</title>
    <script language="javascript" tal:content="string:var portal_url = '${portal_url}';"/>
    <script language="javascript">

        function resizeIframe() {
            $("#iframe").height($(window).height()-5);
        }

        function hideIframeCallback() {
            $("#iframe").css('display','none');
        }

        $(document).ready(function() {
            $(window).resize(resizeIframe());
        });

        function siteLoaded() {
            $("#iframe").contents().find("head").append('<link rel="stylesheet" type="text/css" media="all" href="' + portal_url + '/zopra_popup.css" '+'/>')
            $("#iframe").contents().find("body").append('<script type="text/javascript">'+
            '$($("#iframe")[0].contentWindow).unload(function(){'+
            '   hideIframeCallback();'+
            '});\n'+
            '<'+'/script>');
            // Check now for new messages
            /* TODO: remove this?
            var message = $("#iframe").contents().find(".portalMessage > span");
            if (message.length > 0)
                message.append("<span style='color:red;'>Bitte schlie&szlig;en Sie dieses Fenster, wenn Sie mit der Aktion fertig sind. Sie k&ouml;nnen dann im Formular fortfahren. Bitte speichern Sie das Formular, falls noch weitere Felder bearbeitet werden.<"+"/span>");
            */
            var form = $('#iframe').contents().find("form");
            if (form.length > 0) {
                form.submit(function(event) {
                    $("#iframe").hide();
                });
            }

            $("#iframe").ready(function() { // to be called after injected css has been applied
                $("#iframe").css('display','inline');
            });

        }

    </script>
</head>
<body>
<div class="background" i18n:translate="zopra_popup_working">Request in progress. Please wait...</div>
<iframe tal:attributes="src request/url" frameborder="0" width="100%" frameborder="0" onload="siteLoaded();" id="iframe"></iframe>
</body>
</html>

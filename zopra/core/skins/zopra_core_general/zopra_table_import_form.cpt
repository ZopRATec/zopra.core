<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="zopra">

  <body>
    <tal:comment tal:replace="nothing">

    </tal:comment>

    <metal:topslot fill-slot="top_slot">
          <tal:block tal:define="global isAnon context/@@plone_portal_state/anonymous;"></tal:block>
    </metal:topslot>

    <metal:main fill-slot="main" tal:define="global importresult nothing;">

      <tal:block tal:condition="isAnon">
        <tal:block replace="context/raiseUnauthorized"></tal:block>
      </tal:block>

      <tal:block tal:define="fhandle python: request.get('file');
                             table request/table|nothing"
                 tal:condition="fhandle">
        <tal:call tal:define="global importresult python: here.importTable(fhandle, table, request.get('tabs'))" />
      </tal:block>

      <form name="import_form"
            action="."
            method="post"
            enctype="multipart/form-data"
            tal:define="errors options/state/getErrors;
                     table request/table;
                     tobj python: here.tableHandler[table];
                     coltypes python:tobj.getColumnDefs(True);
                     cols python:coltypes.keys();"
            tal:attributes="action string:${here/getId}/${template/getId}">

        <h1 i18n:translate="" tal:content="python: 'Import ' + tobj.getLabel()"></h1>
        <fieldset>

          <legend i18n:translate="">Datei-Import</legend>
          <div class="field">
            <label for="file" i18n:translate="">Datei</label>
            <div class="formHelp" i18n:translate="">
                Die Importdaten (z.B. aus Excel) als komma-separierter oder tabstopp-separierter Text (CSV).
            </div>

            <input type="file" name="file" />

          </div>

          <div class="field">
            <label for="tabs" i18n:translate="">tab-separiertes Format</label>
            <div class="formHelp" i18n:translate="">
                Aktivieren Sie diese Option, wenn die Datei als tab-separierter Text formatiert ist.
            </div>

            <input type="checkbox" name="tabs" value="1" />

          </div>
        </fieldset>

          <div class="formControls"
               tal:define="process_creation request/process_creation|nothing;">

            <input class="context"
                   type="submit"
                   name="form.button.Save"
                   value="Save"
                   i18n:domain="plone"
                   i18n:attributes="value"
            />

            <input class="standalone"
                   type="submit"
                   name="form.button.Cancel"
                   value="Cancel"
                   i18n:attributes="value"
            />

          </div>
          <div id="import result"
               tal:condition="importresult" tal:content="structure python: importresult.replace('\n', '<br />')">
            Import Result
          </div>
          <input type="hidden" name="form.submitted" value="1" />
          <input type="hidden" name="table" tal:attributes="value table" />

      </form>
    </metal:main>

  </body>
</html>
